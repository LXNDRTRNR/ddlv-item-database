<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Table</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root {
  --bg:#121212;
  --surface:#1e1e1e;
  --border:#333;
  --text:#ffffff;
  --muted:#aaaaaa;
  --accent:#0d6efd;
}

body.light{
  --bg:#f5f5f5;
  --surface:#ffffff;
  --border:#dddddd;
  --text:#111111;
  --muted:#666666;
}

body{
  background:var(--bg);
  color:var(--text);
  font-size:.85rem;
  margin:0;
}

.top-block{
  position:sticky;
  top:0;
  z-index:1000;
  background:var(--bg);
  padding:20px 0 10px;
}

.top-inner{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;
  padding:15px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.search-input{
  background:var(--bg);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:999px;
  padding:8px 16px;
  flex:1;
  max-width:600px;
}

.table-wrapper{
  margin-top:15px;
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}

.data-table{
  width:100%;
  table-layout:fixed;
  border-collapse:collapse;
}

.data-table thead{
  background:var(--border);
}

.data-table th,
.data-table td{
  padding:8px 10px;
  border-bottom:1px solid var(--border);
  border-right:1px solid var(--border);
  word-wrap:break-word;
  overflow:hidden;
  text-overflow:ellipsis;
}

.data-table th:last-child,
.data-table td:last-child{
  border-right:none;
}

/* ADD THIS SECTION - Column width controls */
/* Column 1: Item Code */
.data-table th:nth-child(1),
.data-table td:nth-child(1){
  width:18%; /* Adjust this percentage */
  white-space:nowrap;
}

/* Column 2: Item Name */
.data-table th:nth-child(2),
.data-table td:nth-child(2){
  width:20%; /* Adjust this percentage */
  white-space:nowrap;
}

/* Column 3: Category */
.data-table th:nth-child(3),
.data-table td:nth-child(3){
  width:15%; /* Adjust this percentage */
  white-space:nowrap;
}

/* Column 4: Notes & Warnings */
.data-table th:nth-child(4),
.data-table td:nth-child(4){
  width:47%; /* Adjust this percentage */
  white-space:nowrap;
  font-size:.75rem; /* Smaller font to prevent wrapping */
}
/* END OF COLUMN WIDTH SECTION */

/* Red background - white text (both modes) */
.data-table td.bg-red {
  color: #ffffff !important;
}

/* Yellow background - black text (both modes) */
.data-table td.bg-yellow {
  color: #000000 !important;
}

/* Blue background - black text (both modes) */
.data-table td.bg-blue {
  color: #000000 !important;
}

.copy-btn{
  font-size:.7rem;
  padding:3px 8px;
  margin-left:8px;
  border-radius:6px;
  background:var(--accent);
  color:#fff;
  border:none;
  cursor:pointer;
  flex-shrink:0; /* ADD THIS - prevents button from shrinking */
}

.modal-content{
  background:var(--surface);
  color:var(--text);
  border:1px solid var(--border);
}

.btn-close{
  filter:invert(1);
}

body.light .btn-close{
  filter:invert(0);
}
</style>
</head>

<body>
<div class="container-fluid">

<div class="top-block">
<div class="row">
<div class="col-2"></div>
<div class="col-8">
<div class="top-inner">

<label class="form-check form-switch">
<input class="form-check-input" type="checkbox" id="themeToggle">
</label>

<input type="text" id="searchInput" class="form-control search-input" placeholder="Search">

<button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#importantModal">
<i class="fa-solid fa-triangle-exclamation"></i> IMPORTANT
</button>

</div>
</div>
<div class="col-2"></div>
</div>
</div>

<div class="row mt-3">
<div class="col-2"></div>
<div class="col-8">
<div class="table-wrapper">
<table class="data-table">
<thead><tr id="tableHead"></tr></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>
<div class="col-2"></div>
</div>

</div>

<div class="modal fade" id="importantModal" tabindex="-1">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">IMPORTANT</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p style="color:red;font-weight:bold;">
INSERTING ITEMS THAT ARE UNRELEASED HAS THE POTENTIAL TO BREAK YOUR GAME, AS WAS FOUND WITH ITEMS PEOPLE ADDED BEING REMOVED CAUSING THEIR SAVE GAMES TO BECOME CORRUPT. YOU ADD THESE ITEMS AT YOUR OWN RISK AND I AM NOT AT FAULT. ALWAYS BACK UP YOUR SAVE. - RubyElf
</p>
<p>
Highlighted <span style="background-color:#ffff00; color:#000000; font-weight:bold; padding:0 3px;">YELLOW</span> means I am not sure if it's safe or you should not craft early/have more than 1.<br><br>
Highlighted <span style="background-color:#0d6efd; color:#000000; padding:0 3px;">BLUE</span> means you can get it as a quest reward and could break your save if you get it early<br><br>
IF IT'S HIGHLIGHTED IN RED DON'T USE IT!
</p>
</div>
</div>
</div>
</div>

<script>
(function(){
'use strict';

let rawData=[];
let headers=[];
let searchTimeout=null;

const tbody=document.getElementById('tableBody');
const theadRow=document.getElementById('tableHead');
const searchInput=document.getElementById('searchInput');
const themeToggle=document.getElementById('themeToggle');

fetch('data.json')
.then(res=>res.json())
.then(data=>{
rawData=data;
if(data.length>0){
headers=Object.keys(data[0]);
buildHeaders();
renderTable();
}
});

function buildHeaders(){
theadRow.innerHTML='';
headers.forEach(h=>{
const th=document.createElement('th');
th.textContent=h;
theadRow.appendChild(th);
});
}

function normalizeHex(hex){
if(!hex) return '';
hex=hex.toUpperCase().replace(/\s/g,'');
if(hex.length===4 && hex[0]==='#'){
hex='#'+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];
}
return hex;
}

function getColorClass(bgColor){
if(!bgColor) return '';

const hex=normalizeHex(bgColor);

// Red variants
if(hex==='#FF0000' || hex==='#DC3545' || hex==='#F00000' || 
   hex==='#FF0001' || hex==='#FE0000'){
return 'bg-red';
}

// Yellow variants
if(hex==='#FFFF00' || hex==='#FFFF01' || hex==='#FEFE00'){
return 'bg-yellow';
}

// Blue variants
if(hex==='#0000FF' || hex==='#0D6EFD' || hex==='#0000FE' || 
   hex==='#0001FF' || hex==='#0D6DFD'){
return 'bg-blue';
}

return '';
}

function renderTable(){
const searchValue=searchInput.value.toLowerCase();
const fragment=document.createDocumentFragment();

rawData.forEach(row=>{

const rowText=headers.map(h=>row[h]?.value??'').join(' ').toLowerCase();
if(searchValue && !rowText.includes(searchValue)) return;

const tr=document.createElement('tr');

headers.forEach((header,colIndex)=>{
const td=document.createElement('td');

const cell=row[header];
const value=cell?.value??'';
const bg=cell?.background??'';

td.textContent=value;

// Apply color class based on background
const colorClass=getColorClass(bg);
if(colorClass){
td.className=colorClass;
}

// Apply background color
if(bg && bg!=='#ffffff' && bg!=='#000000'){
td.style.backgroundColor=bg;
}

if(colIndex===0){
td.style.display='flex';
td.style.alignItems='center';
td.style.justifyContent='space-between';

const span=document.createElement('span');
span.textContent=value;
td.textContent='';
td.appendChild(span);

const btn=document.createElement('button');
btn.className='copy-btn';
btn.textContent='Copy';
btn.onclick=()=>copyToClipboard(btn,value);
td.appendChild(btn);
}

tr.appendChild(td);
});

fragment.appendChild(tr);
});

tbody.innerHTML='';
tbody.appendChild(fragment);
}

searchInput.addEventListener('input',()=>{
clearTimeout(searchTimeout);
searchTimeout=setTimeout(renderTable,150);
});

function copyToClipboard(btn,text){
navigator.clipboard.writeText(text).then(()=>{
btn.textContent='Copied!';
setTimeout(()=>btn.textContent='Copy',1500);
});
}

themeToggle.addEventListener('change',()=>{
document.body.classList.toggle('light');
});

window.addEventListener('load',()=>{
const modal=new bootstrap.Modal(document.getElementById('importantModal'));
modal.show();
});

})();
</script>

</body>
</html>
