<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Table</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root {
  --bg:#121212;
  --surface:#1e1e1e;
  --border:#333;
  --text:#ffffff;
  --muted:#aaaaaa;
  --accent:#0d6efd;
}

body.light{
  --bg:#f5f5f5;
  --surface:#ffffff;
  --border:#dddddd;
  --text:#111111;
  --muted:#666666;
}

body{
  background:var(--bg);
  color:var(--text);
  font-size:.85rem;
  margin:0;
}

.top-block{
  position:sticky;
  top:0;
  z-index:1000;
  background:var(--bg);
  padding:20px 0 10px;
}

.top-inner{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;
  padding:15px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.info-panel{
  position:fixed;
  top:20px;
  left:20px;
  z-index:999;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:12px;
  transition:all .3s ease;
}

.info-panel.expanded{
  padding:15px;
  width:280px;
}

.info-panel.collapsed{
  padding:0;
  width:50px;
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.info-toggle{
  position:absolute;
  top:10px;
  right:10px;
  background:transparent;
  border:none;
  color:var(--text);
  cursor:pointer;
  font-size:1rem;
  padding:5px;
  line-height:1;
}

.info-panel.collapsed .info-toggle{
  display:none;
}

.info-content{
  font-size:.8rem;
  line-height:1.8;
}

.info-panel.collapsed .info-content{
  display:none;
}

.info-icon{
  font-size:1.5rem;
  color:var(--text);
  display:none;
}

.info-panel.collapsed .info-icon{
  display:block;
}

.info-content a{
  color:var(--accent);
  text-decoration:none;
}

.info-content a:hover{
  text-decoration:underline;
}

.search-input{
  background:var(--bg);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:999px;
  padding:8px 16px;
  flex:1;
  max-width:600px;
}

.theme-switch{
  position:relative;
  width:60px;
  height:30px;
  flex-shrink:0;
}

.theme-switch input{
  display:none;
}

.slider{
  position:absolute;
  inset:0;
  background-color:#444;
  border-radius:999px;
  transition:background-color .3s;
  cursor:pointer;
}

.slider:before{
  position:absolute;
  content:"\f186";
  height:24px;
  width:24px;
  left:3px;
  top:3px;
  background-color:white;
  border-radius:50%;
  transition:transform .3s;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:"Font Awesome 6 Free";
  font-weight:900;
  font-size:12px;
  color:#111;
}

input:checked + .slider{
  background-color:#0d6efd;
}

input:checked + .slider:before{
  transform:translateX(30px);
  content:"\f185";
}

.table-wrapper{
  margin-top:15px;
  border:1px solid var(--border);
  border-radius:12px;
  overflow:auto;
  max-height:calc(100vh - 150px);
}

.data-table{
  width:100%;
  table-layout:fixed;
  border-collapse:collapse;
}

.data-table thead{
  position:sticky;
  top:0;
  z-index:10;
  background:var(--border);
}

.data-table th{
  padding:8px 10px;
  border-bottom:1px solid var(--border);
  border-right:1px solid var(--border);
  word-wrap:break-word;
  overflow:hidden;
  text-overflow:ellipsis;
  background:var(--border);
}

.data-table td{
  padding:8px 10px;
  border-bottom:1px solid var(--border);
  border-right:1px solid var(--border);
  word-wrap:break-word;
  overflow:hidden;
  text-overflow:ellipsis;
}

.data-table th:last-child,
.data-table td:last-child{
  border-right:none;
}

/* Column width controls */
/* Column 1: Item Code */
.data-table th:nth-child(1){
  width:16%;
  white-space:nowrap;
}

.data-table td:nth-child(1){
  width:16%;
  white-space:nowrap;
  padding:0;
}

.item-code-cell{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 10px;
  height:100%;
}

/* Column 2: Item Name */
.data-table th:nth-child(2),
.data-table td:nth-child(2){
  width:24%;
  white-space:nowrap;
}

/* Column 3: Category */
.data-table th:nth-child(3),
.data-table td:nth-child(3){
  width:18%;
  white-space:nowrap;
}

/* Column 4: Notes & Warnings */
.data-table th:nth-child(4),
.data-table td:nth-child(4){
  width:42%;
  white-space:nowrap;
}

/* Red background - white text (both modes) */
.data-table td.bg-red {
  color: #ffffff !important;
}

/* Yellow background - black text (both modes) */
.data-table td.bg-yellow {
  color: #000000 !important;
}

/* Blue background - black text (both modes) */
.data-table td.bg-blue {
  color: #000000 !important;
}

.copy-btn{
  font-size:.7rem;
  padding:3px 8px;
  margin-left:8px;
  border-radius:6px;
  background:var(--accent);
  color:#fff;
  border:none;
  cursor:pointer;
  flex-shrink:0;
  white-space:nowrap;
}

.btn-important{
  display:flex;
  align-items:center;
  gap:5px;
  font-weight:bold;
  flex-shrink:0;
}

.modal-content{
  background:var(--surface);
  color:var(--text);
  border:1px solid var(--border);
}

.btn-close{
  filter:invert(1);
}

body.light .btn-close{
  filter:invert(0);
}
</style>
</head>

<body>
<div class="container-fluid">

<!-- Info Panel -->
<div class="info-panel expanded" id="infoPanel">
  <button class="info-toggle" id="infoToggle">
    <i class="fa-solid fa-times"></i>
  </button>
  <div class="info-icon" id="infoIcon">
    <i class="fa-solid fa-info-circle"></i>
  </div>
  <div class="info-content">
    <div><strong>Created by:</strong> <a href="https://www.threads.com/@lxndrtrnr" target="_blank">LXNDRTRNR</a></div>
    <div><strong>Issues and feedback:</strong> <a href="https://github.com/LXNDRTRNR/ddlv-item-database/issues" target="_blank">GitHub</a></div>
    <div><strong>Support the creator:</strong> <a href="https://paypal.me/LXNDRTRNR" target="_blank">Tip here</a></div>
  </div>
</div>

<div class="top-block">
<div class="row">
<div class="col-2"></div>
<div class="col-8">
<div class="top-inner">

<label class="theme-switch">
<input type="checkbox" id="themeToggle">
<span class="slider"></span>
</label>

<input type="text" id="searchInput" class="form-control search-input" placeholder="Search">

<button class="btn btn-danger btn-sm btn-important" data-bs-toggle="modal" data-bs-target="#importantModal">
<i class="fa-solid fa-triangle-exclamation"></i> IMPORTANT
</button>

</div>
</div>
<div class="col-2"></div>
</div>
</div>

<div class="row mt-3">
<div class="col-2"></div>
<div class="col-8">
<div class="table-wrapper">
<table class="data-table">
<thead><tr id="tableHead"></tr></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>
<div class="col-2"></div>
</div>

</div>

<div class="modal fade" id="importantModal" tabindex="-1">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">IMPORTANT</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p style="color:red;font-weight:bold;">
INSERTING ITEMS THAT ARE UNRELEASED HAS THE POTENTIAL TO BREAK YOUR GAME, AS WAS FOUND WITH ITEMS PEOPLE ADDED BEING REMOVED CAUSING THEIR SAVE GAMES TO BECOME CORRUPT. YOU ADD THESE ITEMS AT YOUR OWN RISK AND I AM NOT AT FAULT. ALWAYS BACK UP YOUR SAVE. - RubyElf
</p>
<p>
Highlighted <span style="background-color:#ffff00; color:#000000; font-weight:bold; padding:0 3px;">YELLOW</span> means I am not sure if it's safe or you should not craft early/have more than 1.<br><br>
Highlighted <span style="background-color:#0d6efd; color:#000000; padding:0 3px;">BLUE</span> means you can get it as a quest reward and could break your save if you get it early<br><br>
IF IT'S HIGHLIGHTED IN RED DON'T USE IT!
</p>
</div>
</div>
</div>
</div>

<script>
(function(){
'use strict';

let rawData=[];
let headers=[];
let searchTimeout=null;

const tbody=document.getElementById('tableBody');
const theadRow=document.getElementById('tableHead');
const searchInput=document.getElementById('searchInput');
const themeToggle=document.getElementById('themeToggle');
const infoPanel=document.getElementById('infoPanel');
const infoToggle=document.getElementById('infoToggle');
const infoIcon=document.getElementById('infoIcon');

// Info panel toggle
infoToggle.addEventListener('click',()=>{
  infoPanel.classList.remove('expanded');
  infoPanel.classList.add('collapsed');
});

infoIcon.addEventListener('click',()=>{
  infoPanel.classList.remove('collapsed');
  infoPanel.classList.add('expanded');
});

fetch('data.json')
.then(res=>res.json())
.then(data=>{
rawData=data;
if(data.length>0){
headers=Object.keys(data[0]);
buildHeaders();
renderTable();
}
});

function buildHeaders(){
theadRow.innerHTML='';
headers.forEach(h=>{
const th=document.createElement('th');
th.textContent=h;
theadRow.appendChild(th);
});
}

function normalizeHex(hex){
if(!hex) return '';
hex=hex.toUpperCase().replace(/\s/g,'');
if(hex.length===4 && hex[0]==='#'){
hex='#'+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];
}
return hex;
}

function getColorClass(bgColor){
if(!bgColor) return '';

const hex=normalizeHex(bgColor);

// Red variants
if(hex==='#FF0000' || hex==='#DC3545' || hex==='#F00000' || 
   hex==='#FF0001' || hex==='#FE0000'){
return 'bg-red';
}

// Yellow variants
if(hex==='#FFFF00' || hex==='#FFFF01' || hex==='#FEFE00'){
return 'bg-yellow';
}

// Blue variants
if(hex==='#0000FF' || hex==='#0D6EFD' || hex==='#0000FE' || 
   hex==='#0001FF' || hex==='#0D6DFD'){
return 'bg-blue';
}

return '';
}

function renderTable(){
const searchValue=searchInput.value.toLowerCase();
const fragment=document.createDocumentFragment();

rawData.forEach(row=>{

const rowText=headers.map(h=>row[h]?.value??'').join(' ').toLowerCase();
if(searchValue && !rowText.includes(searchValue)) return;

const tr=document.createElement('tr');

headers.forEach((header,colIndex)=>{
const td=document.createElement('td');

const cell=row[header];
const value=cell?.value??'';
const bg=cell?.background??'';

// Apply color class based on background
const colorClass=getColorClass(bg);
if(colorClass){
td.className=colorClass;
}

// Apply background color
if(bg && bg!=='#ffffff' && bg!=='#000000'){
td.style.backgroundColor=bg;
}

if(colIndex===0){
const wrapper=document.createElement('div');
wrapper.className='item-code-cell';

const span=document.createElement('span');
span.textContent=value;
wrapper.appendChild(span);

const btn=document.createElement('button');
btn.className='copy-btn';
btn.textContent='Copy';
btn.onclick=()=>copyToClipboard(btn,value);
wrapper.appendChild(btn);

td.appendChild(wrapper);
} else {
td.textContent=value;
}

tr.appendChild(td);
});

fragment.appendChild(tr);
});

tbody.innerHTML='';
tbody.appendChild(fragment);
}

searchInput.addEventListener('input',()=>{
clearTimeout(searchTimeout);
searchTimeout=setTimeout(renderTable,150);
});

function copyToClipboard(btn,text){
navigator.clipboard.writeText(text).then(()=>{
btn.textContent='Copied!';
setTimeout(()=>btn.textContent='Copy',1500);
});
}

themeToggle.addEventListener('change',()=>{
document.body.classList.toggle('light');
});

window.addEventListener('load',()=>{
const modal=new bootstrap.Modal(document.getElementById('importantModal'));
modal.show();
});

})();
</script>

</body>
</html>
